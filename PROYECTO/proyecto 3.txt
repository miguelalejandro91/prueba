#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>

#define MAXimo 100

// Estructura para almacenar los datos de una cuenta bancaria
typedef struct {
    int numeroCuenta;
    float saldo;
} CuentaBancaria;

// Función para guardar los registros en un archivo CSV
void guardarRegistro(CuentaBancaria cuenta) {
    FILE* archivo;
    archivo = fopen("registros.csv", "a"); // Abrir archivo en modo "append"

    if (archivo == NULL) {
        printf("Error al abrir el archivo.\n");
        return;
    }

    // Obtener la fecha y hora actual
    time_t tiempo;
    struct tm* fecha;
    char fechaHora[MAXimo];

    tiempo = time(NULL);
    fecha = localtime(&tiempo);
    strftime(fechaHora, MAXimo, "%Y-%m-%d %H:%M:%S", fecha);

    // Guardar los datos en el archivo CSV
    fprintf(archivo, "%d,%.2f,%s\n", cuenta.numeroCuenta, cuenta.saldo, fechaHora);

    fclose(archivo);
}

// Función para realizar un depósito en una cuenta
void realizarDeposito(CuentaBancaria* cuenta, float monto) {
    cuenta->saldo += monto;
    guardarRegistro(*cuenta);
    printf("Deposito realizado con exito.\n");
}

// Función para realizar un retiro de una cuenta
void realizarRetiro(CuentaBancaria* cuenta, float monto) {
    if (monto > cuenta->saldo) {
        printf("Saldo insuficiente.\n");
        return;
    }

    cuenta->saldo -= monto;
    guardarRegistro(*cuenta);
    printf("Retiro realizado con exito.\n");
}

// Función para consultar el saldo de una cuenta
void consultarSaldo(CuentaBancaria cuenta) {
    printf("Saldo actual: %.2f\n", cuenta.saldo);
}

int main() {
    CuentaBancaria cuenta;
    printf("Ingrese el numero de cuenta: ");
    scanf("%d", &cuenta.numeroCuenta);

    cuenta.saldo = 1000.0;

    int opcion;
    float monto;

    while (1) {
        printf("\n");
        printf("1. Realizar deposito\n");
        printf("2. Realizar retiro\n");
        printf("3. Consultar saldo\n");
        printf("4. Salir\n");
        printf("Seleccione una opcion: ");
        scanf("%d", &opcion);

        switch (opcion) {
            case 1:
                printf("Ingrese el monto a depositar: ");
                scanf("%f", &monto);
                realizarDeposito(&cuenta, monto);
                break;
            case 2:
                printf("Ingrese el monto a retirar: ");
                scanf("%f", &monto);
                realizarRetiro(&cuenta, monto);
                break;
            case 3:
                consultarSaldo(cuenta);
                break;
            case 4:
                printf("Saliendo del programa...\n");
                exit(0);
            default:
                printf("Opción invalida.\n");
                break;
        }
    }

    return 0;
}
